"use strict";function radianPreset(){this.rad=[],this.sin=[],this.cos=[];for(var t=0;t<360;t++)this.rad.push(t*Math.PI/180),this.sin.push(Math.sin(this.rad[t])),this.cos.push(Math.cos(this.rad[t]))}var gl3=gl3||{};gl3.VERSION="0.0.5",gl3.PI2=6.283185307179586,gl3.PI=3.141592653589793,gl3.PIH=1.5707963267948966,gl3.PIH2=.7853981633974483,gl3.TRI=new radianPreset,console.log("%c◆%c glCubic.js %c◆%c : version %c"+gl3.VERSION,"color: crimson","","color: crimson","","color: royalblue"),gl3.ready=!1,gl3.canvas=null,gl3.gl=null,gl3.textures=null,gl3.textureUnitCount=null,gl3.initGL=function(t,e){var r=e||{};return this.ready=!1,this.canvas=document.getElementById(t),null!=this.canvas&&(this.gl=this.canvas.getContext("webgl",r)||this.canvas.getContext("experimental-webgl",r),null!=this.gl&&(this.ready=!0,this.textureUnitCount=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.textures=new Array(this.textureUnitCount)),this.ready)},gl3.scene_clear=function(t,e,r){var n=this.gl,a=n.COLOR_BUFFER_BIT;n.clearColor(t[0],t[1],t[2],t[3]),null!=e&&(n.clearDepth(e),a|=n.DEPTH_BUFFER_BIT),null!=r&&(n.clearStencil(r),a|=n.STENCIL_BUFFER_BIT),n.clear(a)},gl3.scene_view=function(t,e,r,n,a){var o=e||0,i=r||0,l=n||window.innerWidth,s=a||window.innerHeight;this.gl.viewport(o,i,l,s),null!=t&&(t.aspect=l/s)},gl3.draw_arrays=function(t,e){this.gl.drawArrays(t,0,e)},gl3.draw_elements=function(t,e){this.gl.drawElements(t,e,this.gl.UNSIGNED_SHORT,0)},gl3.bind_texture=function(t,e){null!=this.textures[e]&&(this.gl.activeTexture(33984+t),this.gl.bindTexture(this.textures[e].type,this.textures[e].texture))},gl3.texture_loaded=function(){var t,e,r,n;for(r=!0,n=!1,t=0,e=this.textures.length;t<e;t++)null!=this.textures[t]&&(n=!0,r=r&&this.textures[t].loaded);return!!n&&r},gl3.program={create:function(t,e,r,n,a,o){if(null==gl3.gl)return null;var i,l=new gl3.programManager(gl3.gl);for(l.vs=l.create_shader(t),l.fs=l.create_shader(e),l.prg=l.create_program(l.vs,l.fs),l.attL=new Array(r.length),l.attS=new Array(r.length),i=0;i<r.length;i++)l.attL[i]=gl3.gl.getAttribLocation(l.prg,r[i]),l.attS[i]=n[i];for(l.uniL=new Array(a.length),i=0;i<a.length;i++)l.uniL[i]=gl3.gl.getUniformLocation(l.prg,a[i]);return l.uniT=o,l.location_check(r,a),l},create_from_source:function(t,e,r,n,a,o){if(null==gl3.gl)return null;var i,l=new gl3.programManager(gl3.gl);for(l.vs=l.create_shader_from_source(t,gl3.gl.VERTEX_SHADER),l.fs=l.create_shader_from_source(e,gl3.gl.FRAGMENT_SHADER),l.prg=l.create_program(l.vs,l.fs),l.attL=new Array(r.length),l.attS=new Array(r.length),i=0;i<r.length;i++)l.attL[i]=gl3.gl.getAttribLocation(l.prg,r[i]),l.attS[i]=n[i];for(l.uniL=new Array(a.length),i=0;i<a.length;i++)l.uniL[i]=gl3.gl.getUniformLocation(l.prg,a[i]);return l.uniT=o,l.location_check(r,a),l},create_from_file:function(t,e,r,n,a,o,i){function l(t){var e=new XMLHttpRequest;e.open("GET",t.targetUrl,!0),e.setRequestHeader("Pragma","no-cache"),e.setRequestHeader("Cache-Control","no-cache"),e.onload=function(){console.log("%c◆%c shader source loaded: %c"+t.targetUrl,"color: crimson","","color: goldenrod"),t.source=e.responseText,s()},e.send()}function s(){if(null!=c.vs.source&&null!=c.fs.source){var t;for(u.vs=u.create_shader_from_source(c.vs.source,gl3.gl.VERTEX_SHADER),u.fs=u.create_shader_from_source(c.fs.source,gl3.gl.FRAGMENT_SHADER),u.prg=u.create_program(u.vs,u.fs),u.attL=new Array(r.length),u.attS=new Array(r.length),t=0;t<r.length;t++)u.attL[t]=gl3.gl.getAttribLocation(u.prg,r[t]),u.attS[t]=n[t];for(u.uniL=new Array(a.length),t=0;t<a.length;t++)u.uniL[t]=gl3.gl.getUniformLocation(u.prg,a[t]);u.uniT=o,u.location_check(r,a),i()}}if(null==gl3.gl)return null;var u=new gl3.programManager(gl3.gl),c={vs:{targetUrl:t,source:null},fs:{targetUrl:e,source:null}};return l(c.vs),l(c.fs),u}},gl3.programManager=function(t){this.gl=t},gl3.programManager.prototype.gl=null,gl3.programManager.prototype.vs=null,gl3.programManager.prototype.fs=null,gl3.programManager.prototype.prg=null,gl3.programManager.prototype.attL=null,gl3.programManager.prototype.attS=null,gl3.programManager.prototype.uniL=null,gl3.programManager.prototype.uniT=null,gl3.programManager.prototype.create_shader=function(t){var e,r=document.getElementById(t);if(r){switch(r.type){case"x-shader/x-vertex":e=this.gl.createShader(this.gl.VERTEX_SHADER);break;case"x-shader/x-fragment":e=this.gl.createShader(this.gl.FRAGMENT_SHADER);break;default:return}return this.gl.shaderSource(e,r.text),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:void console.warn("◆ compile failed of shader: "+this.gl.getShaderInfoLog(e))}},gl3.programManager.prototype.create_shader_from_source=function(t,e){var r;switch(e){case this.gl.VERTEX_SHADER:r=this.gl.createShader(this.gl.VERTEX_SHADER);break;case this.gl.FRAGMENT_SHADER:r=this.gl.createShader(this.gl.FRAGMENT_SHADER);break;default:return}return this.gl.shaderSource(r,t),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:void console.warn("◆ compile failed of shader: "+this.gl.getShaderInfoLog(r))},gl3.programManager.prototype.create_program=function(t,e){var r=this.gl.createProgram();return this.gl.attachShader(r,t),this.gl.attachShader(r,e),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?(this.gl.useProgram(r),r):void console.warn("◆ link program failed: "+this.gl.getProgramInfoLog(r))},gl3.programManager.prototype.set_program=function(){this.gl.useProgram(this.prg)},gl3.programManager.prototype.set_attribute=function(t,e){for(var r in t)this.attL[r]>=0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t[r]),this.gl.enableVertexAttribArray(this.attL[r]),this.gl.vertexAttribPointer(this.attL[r],this.attS[r],this.gl.FLOAT,!1,0,0));null!=e&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e)},gl3.programManager.prototype.push_shader=function(t){for(var e=0,r=this.uniT.length;e<r;e++)switch(this.uniT[e]){case"matrix4fv":this.gl.uniformMatrix4fv(this.uniL[e],!1,t[e]);break;case"4fv":this.gl.uniform4fv(this.uniL[e],t[e]);break;case"3fv":this.gl.uniform3fv(this.uniL[e],t[e]);break;case"2fv":this.gl.uniform2fv(this.uniL[e],t[e]);break;case"1fv":this.gl.uniform1fv(this.uniL[e],t[e]);break;case"1f":this.gl.uniform1f(this.uniL[e],t[e]);break;case"1iv":this.gl.uniform1iv(this.uniL[e],t[e]);break;case"1i":this.gl.uniform1i(this.uniL[e],t[e]);break;case"matrix3fv":this.gl.uniformMatrix3fv(this.uniL[e],!1,t[e]);break;case"matrix2fv":this.gl.uniformMatrix2fv(this.uniL[e],!1,t[e])}},gl3.programManager.prototype.location_check=function(t,e){var r,n;for(r=0,n=t.length;r<n;r++)(null==this.attL[r]||this.attL[r]<0)&&console.warn('◆ invalid attribute location: %c"'+t[r]+'"',"color: crimson");for(r=0,n=e.length;r<n;r++)(null==this.uniL[r]||this.uniL[r]<0)&&console.warn('◆ invalid uniform location: %c"'+e[r]+'"',"color: crimson")},gl3.create_vbo=function(t){if(null!=t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}},gl3.create_ibo=function(t){if(null!=t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Int16Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),e}},gl3.create_texture=function(t,e,r){if(null!=t&&null!=e){var n=new Image,a=this,o=this.gl;n.onload=function(){a.textures[e]={texture:null,type:null,loaded:!1};var i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n),o.generateMipmap(o.TEXTURE_2D),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),a.textures[e].texture=i,a.textures[e].type=o.TEXTURE_2D,a.textures[e].loaded=!0,console.log("%c◆%c texture number: %c"+e+"%c, image loaded: %c"+t,"color: crimson","","color: blue","","color: goldenrod"),o.bindTexture(o.TEXTURE_2D,null),null!=r&&r(e)},n.src=t}},gl3.create_texture_canvas=function(t,e){if(null!=t&&null!=e){var r=this.gl,n=r.createTexture();this.textures[e]={texture:null,type:null,loaded:!1},r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),this.textures[e].texture=n,this.textures[e].type=r.TEXTURE_2D,this.textures[e].loaded=!0,console.log("%c◆%c texture number: %c"+e+"%c, canvas attached","color: crimson","","color: blue",""),r.bindTexture(r.TEXTURE_2D,null)}},gl3.create_framebuffer=function(t,e,r){if(null!=t&&null!=e&&null!=r){var n=this.gl;this.textures[r]={texture:null,type:null,loaded:!1};var a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a);var o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t,e),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,o);var i=n.createTexture();return n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0),n.bindTexture(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),this.textures[r].texture=i,this.textures[r].type=n.TEXTURE_2D,this.textures[r].loaded=!0,console.log("%c◆%c texture number: %c"+r+"%c, framebuffer created","color: crimson","","color: blue",""),{framebuffer:a,depthRenderbuffer:o,texture:i}}},gl3.create_framebuffer_cube=function(t,e,r,n){if(null!=t&&null!=e&&null!=r&&null!=n){var a=this.gl;this.textures[n]={texture:null,type:null,loaded:!1};var o=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,o);var i=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,i),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,i);var l=a.createTexture();a.bindTexture(a.TEXTURE_CUBE_MAP,l);for(var s=0;s<r.length;s++)a.texImage2D(r[s],0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,null);return a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null),this.textures[n].texture=l,this.textures[n].type=a.TEXTURE_CUBE_MAP,this.textures[n].loaded=!0,console.log("%c◆%c texture number: %c"+n+"%c, framebuffer cube created","color: crimson","","color: blue",""),{framebuffer:o,depthRenderbuffer:i,texture:l}}},gl3.create_texture_cube=function(t,e,r,n){function a(){this.data=new Image,this.data.onload=function(){this.imageDataLoaded=!0,o()}}function o(){l[0].data.imageDataLoaded&&l[1].data.imageDataLoaded&&l[2].data.imageDataLoaded&&l[3].data.imageDataLoaded&&l[4].data.imageDataLoaded&&l[5].data.imageDataLoaded&&i()}function i(){var a=s.createTexture();s.bindTexture(s.TEXTURE_CUBE_MAP,a);for(var o=0;o<t.length;o++)s.texImage2D(e[o],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,l[o].data);s.generateMipmap(s.TEXTURE_CUBE_MAP),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),u.textures[r].texture=a,u.textures[r].type=s.TEXTURE_CUBE_MAP,u.textures[r].loaded=!0,console.log("%c◆%c texture number: %c"+r+"%c, image loaded: %c"+t[0]+"...","color: crimson","","color: blue","","color: goldenrod"),s.bindTexture(s.TEXTURE_CUBE_MAP,null),null!=n&&n(r)}if(null!=t&&null!=e&&null!=r){var l=[],s=this.gl,u=this;this.textures[r]={texture:null,type:null,loaded:!1};for(var c=0;c<t.length;c++)l[c]=new a,l[c].data.src=t[c]}},gl3.util={hsva:function(t,e,r,n){if(!(e>1||r>1||n>1)){var a=t%360,o=Math.floor(a/60),i=a/60-o,l=r*(1-e),s=r*(1-e*i),u=r*(1-e*(1-i)),c=new Array;if(!e>0&&!e<0)c.push(r,r,r,n);else{var g=new Array(r,s,l,l,u,r),h=new Array(u,r,r,s,l,l),f=new Array(l,l,u,r,r,s);c.push(g[o],h[o],f[o],n)}return c}},easeLiner:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeOutCubic:function(t){return(t=t/1-1)*t*t+1},easeQuintic:function(t){var e=(t/=1)*t,r=e*t;return r*e}},gl3.v3=function(){},gl3.v3.prototype.create=function(){return new Float32Array(3)},gl3.v3.prototype.normalize=function(t){var e=this.create(),r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);if(r>0){var n=1/r;e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}return e},gl3.v3.prototype.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},gl3.v3.prototype.cross=function(t,e){var r=this.create();return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r},gl3.v3.prototype.faceNormal=function(t,e,r){var n=this.create(),a=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],o=[r[0]-t[0],r[1]-t[1],r[2]-t[2]];return n[0]=a[1]*o[2]-a[2]*o[1],n[1]=a[2]*o[0]-a[0]*o[2],n[2]=a[0]*o[1]-a[1]*o[0],this.normalize(n)},gl3.vec3=new gl3.v3,gl3.m4=function(){},gl3.m4.prototype.create=function(){return new Float32Array(16)},gl3.m4.prototype.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gl3.m4.prototype.multiply=function(t,e,r){var n=t[0],a=t[1],o=t[2],i=t[3],l=t[4],s=t[5],u=t[6],c=t[7],g=t[8],h=t[9],f=t[10],E=t[11],p=t[12],d=t[13],T=t[14],R=t[15],_=e[0],m=e[1],v=e[2],A=e[3],b=e[4],x=e[5],y=e[6],U=e[7],M=e[8],P=e[9],D=e[10],L=e[11],S=e[12],F=e[13],B=e[14],I=e[15];return r[0]=_*n+m*l+v*g+A*p,r[1]=_*a+m*s+v*h+A*d,r[2]=_*o+m*u+v*f+A*T,r[3]=_*i+m*c+v*E+A*R,r[4]=b*n+x*l+y*g+U*p,r[5]=b*a+x*s+y*h+U*d,r[6]=b*o+x*u+y*f+U*T,r[7]=b*i+x*c+y*E+U*R,r[8]=M*n+P*l+D*g+L*p,r[9]=M*a+P*s+D*h+L*d,r[10]=M*o+P*u+D*f+L*T,r[11]=M*i+P*c+D*E+L*R,r[12]=S*n+F*l+B*g+I*p,r[13]=S*a+F*s+B*h+I*d,r[14]=S*o+F*u+B*f+I*T,r[15]=S*i+F*c+B*E+I*R,r},gl3.m4.prototype.scale=function(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1]*e[0],r[2]=t[2]*e[0],r[3]=t[3]*e[0],r[4]=t[4]*e[1],r[5]=t[5]*e[1],r[6]=t[6]*e[1],r[7]=t[7]*e[1],r[8]=t[8]*e[2],r[9]=t[9]*e[2],r[10]=t[10]*e[2],r[11]=t[11]*e[2],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},gl3.m4.prototype.translate=function(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],r[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],r[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],r[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],r},gl3.m4.prototype.rotate=function(t,e,r,n){var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(!a)return null;var o=r[0],i=r[1],l=r[2];1!=a&&(a=1/a,o*=a,i*=a,l*=a);var s=Math.sin(e),u=Math.cos(e),c=1-u,g=t[0],h=t[1],f=t[2],E=t[3],p=t[4],d=t[5],T=t[6],R=t[7],_=t[8],m=t[9],v=t[10],A=t[11],b=o*o*c+u,x=i*o*c+l*s,y=l*o*c-i*s,U=o*i*c-l*s,M=i*i*c+u,P=l*i*c+o*s,D=o*l*c+i*s,L=i*l*c-o*s,S=l*l*c+u;return e?t!=n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=g*b+p*x+_*y,n[1]=h*b+d*x+m*y,n[2]=f*b+T*x+v*y,n[3]=E*b+R*x+A*y,n[4]=g*U+p*M+_*P,n[5]=h*U+d*M+m*P,n[6]=f*U+T*M+v*P,n[7]=E*U+R*M+A*P,n[8]=g*D+p*L+_*S,n[9]=h*D+d*L+m*S,n[10]=f*D+T*L+v*S,n[11]=E*D+R*L+A*S,n},gl3.m4.prototype.lookAt=function(t,e,r,n){var a=t[0],o=t[1],i=t[2],l=r[0],s=r[1],u=r[2],c=e[0],g=e[1],h=e[2];if(a==c&&o==g&&i==h)return this.identity(n);var f,E,p,d,T,R,_,m,v,A;return _=a-e[0],m=o-e[1],v=i-e[2],A=1/Math.sqrt(_*_+m*m+v*v),_*=A,m*=A,v*=A,f=s*v-u*m,E=u*_-l*v,p=l*m-s*_,A=Math.sqrt(f*f+E*E+p*p),A?(A=1/A,f*=A,E*=A,p*=A):(f=0,E=0,p=0),d=m*p-v*E,T=v*f-_*p,R=_*E-m*f,A=Math.sqrt(d*d+T*T+R*R),A?(A=1/A,d*=A,T*=A,R*=A):(d=0,T=0,R=0),n[0]=f,n[1]=d,n[2]=_,n[3]=0,n[4]=E,n[5]=T,n[6]=m,n[7]=0,n[8]=p,n[9]=R,n[10]=v,n[11]=0,n[12]=-(f*a+E*o+p*i),n[13]=-(d*a+T*o+R*i),n[14]=-(_*a+m*o+v*i),n[15]=1,n},gl3.m4.prototype.perspective=function(t,e,r,n,a){var o=r*Math.tan(t*Math.PI/360),i=o*e,l=2*i,s=2*o,u=n-r;return a[0]=2*r/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-(n+r)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(n*r*2)/u,a[15]=0,a},gl3.m4.prototype.ortho=function(t,e,r,n,a,o,i){var l=e-t,s=r-n,u=o-a;return i[0]=2/l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-2/u,i[11]=0,i[12]=-(t+e)/l,i[13]=-(r+n)/s,i[14]=-(o+a)/u,i[15]=1,i},gl3.m4.prototype.transpose=function(t,e){return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},gl3.m4.prototype.inverse=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],i=t[4],l=t[5],s=t[6],u=t[7],c=t[8],g=t[9],h=t[10],f=t[11],E=t[12],p=t[13],d=t[14],T=t[15],R=r*l-n*i,_=r*s-a*i,m=r*u-o*i,v=n*s-a*l,A=n*u-o*l,b=a*u-o*s,x=c*p-g*E,y=c*d-h*E,U=c*T-f*E,M=g*d-h*p,P=g*T-f*p,D=h*T-f*d,L=1/(R*D-_*P+m*M+v*U-A*y+b*x);return e[0]=(l*D-s*P+u*M)*L,e[1]=(-n*D+a*P-o*M)*L,e[2]=(p*b-d*A+T*v)*L,e[3]=(-g*b+h*A-f*v)*L,e[4]=(-i*D+s*U-u*y)*L,e[5]=(r*D-a*U+o*y)*L,e[6]=(-E*b+d*m-T*_)*L,e[7]=(c*b-h*m+f*_)*L,e[8]=(i*P-l*U+u*x)*L,e[9]=(-r*P+n*U-o*x)*L,e[10]=(E*A-p*m+T*R)*L,e[11]=(-c*A+g*m-f*R)*L,e[12]=(-i*M+l*y-s*x)*L,e[13]=(r*M-n*y+a*x)*L,e[14]=(-E*v+p*_-d*R)*L,e[15]=(c*v-g*_+h*R)*L,e},gl3.m4.prototype.vpFromCamera=function(t,e,r,n){this.lookAt(t.position,t.centerPoint,t.upDirection,e),this.perspective(t.fovy,t.aspect,t.near,t.far,r),this.multiply(r,e,n)},gl3.mat4=new gl3.m4,gl3.q4=function(){},gl3.q4.prototype.create=function(){return new Float32Array(4)},gl3.q4.prototype.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},gl3.q4.prototype.inverse=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},gl3.q4.prototype.normalize=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],o=Math.sqrt(e*e+r*r+n*n+a*a);return 0===o?(t[0]=0,t[1]=0,t[2]=0,t[3]=0):(o=1/o,t[0]=e*o,t[1]=r*o,t[2]=n*o,t[3]=a*o),t},gl3.q4.prototype.multiply=function(t,e,r){var n=t[0],a=t[1],o=t[2],i=t[3],l=e[0],s=e[1],u=e[2],c=e[3];return r[0]=n*c+i*l+a*u-o*s,r[1]=a*c+i*s+o*l-n*u,r[2]=o*c+i*u+n*s-a*l,r[3]=i*c-n*l-a*s-o*u,r},gl3.q4.prototype.rotate=function(t,e,r){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(!n)return null;var a=e[0],o=e[1],i=e[2];1!=n&&(n=1/n,a*=n,o*=n,i*=n);var l=Math.sin(.5*t);return r[0]=a*l,r[1]=o*l,r[2]=i*l,r[3]=Math.cos(.5*t),r},gl3.q4.prototype.toVecIII=function(t,e,r){var n=this.create(),a=this.create(),o=this.create();return this.inverse(e,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],this.multiply(o,n,a),this.multiply(a,e,o),r[0]=o[0],r[1]=o[1],r[2]=o[2],r},gl3.q4.prototype.toMatIV=function(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],i=r+r,l=n+n,s=a+a,u=r*i,c=r*l,g=r*s,h=n*l,f=n*s,E=a*s,p=o*i,d=o*l,T=o*s;return e[0]=1-(h+E),e[1]=c-T,e[2]=g+d,e[3]=0,e[4]=c+T,e[5]=1-(u+E),e[6]=f-p,e[7]=0,e[8]=g-d,e[9]=f+p,e[10]=1-(u+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},gl3.q4.prototype.slerp=function(t,e,r,n){var a=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],o=1-a*a;if(o<=0)n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3];else if(o=Math.sqrt(o),Math.abs(o)<1e-4)n[0]=.5*t[0]+.5*e[0],n[1]=.5*t[1]+.5*e[1],n[2]=.5*t[2]+.5*e[2],n[3]=.5*t[3]+.5*e[3];else{var i=Math.acos(a),l=i*r,s=Math.sin(i-l)/o,u=Math.sin(l)/o;n[0]=t[0]*s+e[0]*u,n[1]=t[1]*s+e[1]*u,n[2]=t[2]*s+e[2]*u,n[3]=t[3]*s+e[3]*u}return n},gl3.qtn=new gl3.q4,gl3.camera={create:function(t,e,r,n,a,o,i){var l=new gl3.cam,s=gl3.vec3.create();return s[0]=r[0],s[1]=r[1],s[2]=r[2],s=gl3.vec3.normalize(s),l.init(t,e,s,n,a,o,i),l}},gl3.cam=function(){},gl3.cam.prototype.position=gl3.vec3.create(),gl3.cam.prototype.centerPoint=gl3.vec3.create(),gl3.cam.prototype.upDirection=gl3.vec3.create(),gl3.cam.prototype.basePosition=gl3.vec3.create(),gl3.cam.prototype.baseCenterPoint=gl3.vec3.create(),gl3.cam.prototype.baseUpDirection=gl3.vec3.create(),gl3.cam.prototype.fovy=45,gl3.cam.prototype.aspect=1,gl3.cam.prototype.near=.1,gl3.cam.prototype.far=1,gl3.cam.prototype.init=function(t,e,r,n,a,o,i){this.position=gl3.vec3.create(),this.centerPoint=gl3.vec3.create(),this.upDirection=gl3.vec3.create(),this.basePosition=gl3.vec3.create(),this.baseCenterPoint=gl3.vec3.create(),this.baseUpDirection=gl3.vec3.create(),this.position[0]=this.basePosition[0]=t[0],this.position[1]=this.basePosition[1]=t[1],this.position[2]=this.basePosition[2]=t[2],this.centerPoint[0]=this.baseCenterPoint[0]=e[0],this.centerPoint[1]=this.baseCenterPoint[1]=e[1],this.centerPoint[2]=this.baseCenterPoint[2]=e[2],this.upDirection[0]=this.baseUpDirection[0]=r[0],this.upDirection[1]=this.baseUpDirection[1]=r[1],this.upDirection[2]=this.baseUpDirection[2]=r[2],this.fovy=n,this.aspect=a,this.near=o,this.far=i},gl3.cam.prototype.qtn_rotate=function(t){gl3.qtn.toVecIII(this.basePosition,t,this.position),gl3.qtn.toVecIII(this.baseUpDirection,t,this.upDirection)},gl3.cam.prototype.get_canvas_aspect=function(){if(gl3.canvas)return gl3.canvas.width/gl3.canvas.height},gl3.mesh={plane:function(t,e,r){var n,a,o;n=t/2,a=e/2,o=r?r:[1,1,1,1];var i=[-n,a,0,n,a,0,-n,-a,0,n,-a,0],l=[0,0,1,0,0,1,0,0,1,0,0,1],s=[o[0],o[1],o[2],o[3],o[0],o[1],o[2],o[3],o[0],o[1],o[2],o[3],o[0],o[1],o[2],o[3]],u=[0,0,1,0,0,1,1,1],c=[0,1,2,2,1,3];return{position:i,normal:l,color:s,texCoord:u,index:c}},torus:function(t,e,r,n,a){var o,i,l,s=[],u=[],c=[],g=[],h=[];for(o=0;o<=t;o++){var f=2*Math.PI/t*o,E=Math.cos(f),p=Math.sin(f);for(i=0;i<=e;i++){var d=2*Math.PI/e*i,T=(E*r+n)*Math.cos(d),R=p*r,_=(E*r+n)*Math.sin(d),m=E*Math.cos(d),v=E*Math.sin(d);l=a?a:gl3.util.hsva(360/e*i,1,1,1);var A=1/e*i,b=1/t*o+.5;b>1&&(b-=1),b=1-b,s.push(T,R,_),u.push(m,p,v),c.push(l[0],l[1],l[2],l[3]),g.push(A,b)}}for(o=0;o<t;o++)for(i=0;i<e;i++)f=(e+1)*o+i,h.push(f,f+e+1,f+1),h.push(f+e+1,f+e+2,f+1);return{position:s,normal:u,color:c,texCoord:g,index:h}},sphere:function(t,e,r,n){var a,o,i,l=[],s=[],u=[],c=[],g=[];for(a=0;a<=t;a++){var h=Math.PI/t*a,f=Math.cos(h),E=Math.sin(h);for(o=0;o<=e;o++){var p=2*Math.PI/e*o,d=E*r*Math.cos(p),T=f*r,R=E*r*Math.sin(p),_=E*Math.cos(p),m=E*Math.sin(p);i=n?n:gl3.util.hsva(360/t*a,1,1,1),l.push(d,T,R),s.push(_,f,m),u.push(i[0],i[1],i[2],i[3]),c.push(1-1/e*o,1/t*a)}}for(h=0,a=0;a<t;a++)for(o=0;o<e;o++)h=(e+1)*a+o,g.push(h,h+1,h+e+2),g.push(h,h+e+2,h+e+1);return{position:l,normal:s,color:u,texCoord:c,index:g}},cube:function(t,e){for(var r,n=.5*t,a=[-n,-n,n,n,-n,n,n,n,n,-n,n,n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n,-n,-n,n,-n,-n,n,n,n,n,n,n,n,-n,-n,-n,-n,n,-n,-n,n,-n,n,-n,-n,n,n,-n,-n,n,n,-n,n,n,n,n,-n,n,-n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n],o=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],i=[],l=0;l<a.length/3;l++)r=e?e:gl3.util.hsva(360/a.length/3*l,1,1,1),i.push(r[0],r[1],r[2],r[3]);var s=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:a,normal:o,color:i,texCoord:s,index:u}}},gl3.audioCtr=function(){},gl3.audioCtr.prototype.init=function(t,e){return"undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext?null:("undefined"!=typeof AudioContext?this.ctx=new AudioContext:this.ctx=new webkitAudioContext,this.comp=this.ctx.createDynamicsCompressor(),this.comp.connect(this.ctx.destination),this.bgmGain=this.ctx.createGain(),this.bgmGain.connect(this.comp),this.bgmGain.gain.value=t,this.soundGain=this.ctx.createGain(),this.soundGain.connect(this.comp),this.soundGain.gain.value=e,this.src=[],void 0)},gl3.audioCtr.prototype.load=function(t,e,r,n,a){var o=this.ctx,i=n?this.bgmGain:this.soundGain,l=this.src;l[e]=null;var s=new XMLHttpRequest;s.open("GET",t,!0),s.setRequestHeader("Pragma","no-cache"),s.setRequestHeader("Cache-Control","no-cache"),s.responseType="arraybuffer",s.onload=function(){o.decodeAudioData(s.response,function(s){l[e]=new gl3.audioSrc(o,i,s,r,n),l[e].loaded=!0,console.log("%c◆%c audio number: %c"+e+"%c, audio loaded: %c"+t,"color: crimson","","color: blue","","color: goldenrod"),a()},function(t){console.log(t)})},s.send()},gl3.audioCtr.prototype.loadComplete=function(){var t,e;for(e=!0,t=0;t<this.src.length;t++)e=e&&null!=this.src[t]&&this.src[t].loaded;return e},gl3.audioSrc=function(t,e,r,n,a){this.ctx=t,this.gain=e,this.audioBuffer=r,this.bufferSource=[],this.activeBufferSource=0,this.loop=n,this.loaded=!1,this.fftLoop=16,this.update=!1,this.background=a,this.node=this.ctx.createScriptProcessor(2048,1,1),this.analyser=this.ctx.createAnalyser(),this.analyser.smoothingTimeConstant=.8,this.analyser.fftSize=2*this.fftLoop,this.onData=new Uint8Array(this.analyser.frequencyBinCount)},gl3.audioSrc.prototype.play=function(){function t(t){a.update&&(a.update=!1,a.analyser.getByteFrequencyData(a.onData))}var e,r,n,a=this;if(e=this.bufferSource.length,n=-1,e>0){for(r=0;r<e;r++)if(!this.bufferSource[r].playnow){this.bufferSource[r]=null,this.bufferSource[r]=this.ctx.createBufferSource(),n=r;break}n<0&&(this.bufferSource[this.bufferSource.length]=this.ctx.createBufferSource(),n=this.bufferSource.length-1)}else this.bufferSource[0]=this.ctx.createBufferSource(),n=0;this.activeBufferSource=n,this.bufferSource[n].buffer=this.audioBuffer,this.bufferSource[n].loop=this.loop,this.bufferSource[n].playbackRate.value=1,this.loop||(this.bufferSource[n].onended=function(){this.stop(0),this.playnow=!1}),this.background&&(this.bufferSource[n].connect(this.analyser),this.analyser.connect(this.node),this.node.connect(this.ctx.destination),this.node.onaudioprocess=function(e){t(e)}),this.bufferSource[n].connect(this.gain),this.bufferSource[n].start(0),this.bufferSource[n].playnow=!0},gl3.audioSrc.prototype.stop=function(){this.bufferSource[this.activeBufferSource].stop(0),this.playnow=!1},gl3.audio=new gl3.audioCtr;