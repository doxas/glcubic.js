function radian(){this.rad=new Array,this.sin=new Array,this.cos=new Array;for(var t=0;360>t;t++)this.rad.push(t*Math.PI/180),this.sin.push(Math.sin(this.rad[t])),this.cos.push(Math.cos(this.rad[t]))}function AudioCtr(t,e){return"undefined"==typeof webkitAudioContext&&"undefined"==typeof AudioContext?null:(this.ctx="undefined"!=typeof webkitAudioContext?new webkitAudioContext:new AudioContext,this.comp=this.ctx.createDynamicsCompressor(),this.comp.connect(this.ctx.destination),this.bgmGain=this.ctx.createGain(),this.bgmGain.connect(this.comp),this.bgmGain.gain.value=t,this.soundGain=this.ctx.createGain(),this.soundGain.connect(this.comp),this.soundGain.gain.value=e,this.src=new Array,void 0)}function AudioSrc(t,e,r,i){this.ctx=t,this.gain=e,this.audioBuffer=r,this.bufferSource=new Array,this.loop=i,this.loaded=!1}var gl3=gl3||{};gl3.PI=3.141592653589793,gl3.PI2=1.5707963267948966,gl3.PI4=.7853981633974483,gl3.BPI=6.283185307179586,gl3.ready=!1,gl3.canvas=null,gl3.gl=null,gl3.texture=null,gl3.initGL=function(t,e){var r=e||{};this.canvas=document.getElementById(t),null!=this.canvas&&(this.gl=this.canvas.getContext("webgl",r)||this.canvas.getContext("experimental-webgl",r),null!=this.gl&&(this.ready=!0,this.texture=new Array(this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS))))},gl3.scene_clear=function(t,e){var r=this.gl.COLOR_BUFFER_BIT;this.gl.clearColor(t[0],t[1],t[2],t[3]),null!=e&&(this.gl.clearDepth(e),this.gl.enable(this.gl.DEPTH_TEST),r|=this.gl.DEPTH_BUFFER_BIT),this.gl.clear(r)},gl3.scene_view=function(t,e,r){var i,a;i=null!=e?e:window.innerWidth,a=null!=r?r:window.innerHeight,this.canvas.width=i,this.canvas.height=a,this.gl.viewport(0,0,i,a),null!=t&&(t.aspect=i/a)},gl3.draw_elements=function(t){this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0)},gl3.bind_texture=function(t){this.gl.activeTexture(33984+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture[t])},gl3.create_vbo=function(t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e},gl3.create_ibo=function(t){var e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Int16Array(t),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),e},gl3.create_texture=function(t,e){var r=new Image,i=this,a=this.gl;r.onload=function(){var t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.generateMipmap(a.TEXTURE_2D),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),i.texture[e]=t,a.bindTexture(a.TEXTURE_2D,null)},r.src=t},gl3.create_texture_canvas=function(t,e){var r=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.texture[e]=r,this.gl.bindTexture(this.gl.TEXTURE_2D,null)},gl3.create_framebuffer=function(t,e){var r=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r);var i=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,i),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,e),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,i);var a=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,a,0),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),{f:r,d:i,t:a}},gl3.create_framebuffer_cube=function(t,e,r){var i=this.gl.createFramebuffer();this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i);var a=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,a),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,e),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,a);var n=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,n);for(var s=0;s<r.length;s++)this.gl.texImage2D(r[s],0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);return this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),{f:i,d:a,t:n}},gl3.create_cube_texture=function(t,e,r){function i(){this.data=new Image,this.data.onload=function(){this.imageDataLoaded=!0,a()}}function a(){s[0].data.imageDataLoaded&&s[1].data.imageDataLoaded&&s[2].data.imageDataLoaded&&s[3].data.imageDataLoaded&&s[4].data.imageDataLoaded&&s[5].data.imageDataLoaded&&n()}function n(){var i=l.createTexture();l.bindTexture(l.TEXTURE_CUBE_MAP,i);for(var a=0;a<t.length;a++)l.texImage2D(e[a],0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,s[a].data);l.generateMipmap(l.TEXTURE_CUBE_MAP),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this.texture[r]=i,l.bindTexture(l.TEXTURE_CUBE_MAP,null)}for(var s=new Array,l=this.gl,o=0;o<t.length;o++)s[o]=new i,s[o].data.src=t[o]},gl3.program={create:function(t,e,r,i,a,n){if(null==gl3.gl)return null;var s,l=new gl3.programManager(gl3.gl);for(l.vs=l.create_shader(t),l.fs=l.create_shader(e),l.prg=l.create_program(l.vs,l.fs),l.attL=new Array(r.length),l.attS=new Array(r.length),s=0;s<r.length;s++)l.attL[s]=gl3.gl.getAttribLocation(l.prg,r[s]),l.attS[s]=i[s];for(l.uniL=new Array(a.length),s=0;s<a.length;s++)l.uniL[s]=gl3.gl.getUniformLocation(l.prg,a[s]);return l.uniT=n,l}},gl3.programManager=function(t){this.gl=t},gl3.programManager.prototype.gl=null,gl3.programManager.prototype.vs=null,gl3.programManager.prototype.fs=null,gl3.programManager.prototype.prg=null,gl3.programManager.prototype.attL=null,gl3.programManager.prototype.attS=null,gl3.programManager.prototype.uniL=null,gl3.programManager.prototype.uniT=null,gl3.programManager.prototype.create_shader=function(t){var e,r=document.getElementById(t);if(r){switch(r.type){case"x-shader/x-vertex":e=this.gl.createShader(this.gl.VERTEX_SHADER);break;case"x-shader/x-fragment":e=this.gl.createShader(this.gl.FRAGMENT_SHADER);break;default:return}return this.gl.shaderSource(e,r.text),this.gl.compileShader(e),this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)?e:void alert(this.gl.getShaderInfoLog(e))}},gl3.programManager.prototype.create_program=function(t,e){var r=this.gl.createProgram();return this.gl.attachShader(r,t),this.gl.attachShader(r,e),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?(this.gl.useProgram(r),r):void alert(this.gl.getProgramInfoLog(r))},gl3.programManager.prototype.set_program=function(){this.gl.useProgram(this.prg)},gl3.programManager.prototype.set_attribute=function(t,e){for(var r in t)this.attL[r]>=0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t[r]),this.gl.enableVertexAttribArray(this.attL[r]),this.gl.vertexAttribPointer(this.attL[r],this.attS[r],this.gl.FLOAT,!1,0,0));this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e)},gl3.programManager.prototype.push_shader=function(t){for(var e=0,r=this.uniT.length;r>e;e++)switch(this.uniT[e]){case"matrix4fv":this.gl.uniformMatrix4fv(this.uniL[e],!1,t[e]);break;case"4fv":this.gl.uniform4fv(this.uniL[e],t[e]);break;case"3fv":this.gl.uniform3fv(this.uniL[e],t[e]);break;case"2fv":this.gl.uniform2fv(this.uniL[e],t[e]);break;case"1fv":this.gl.uniform1fv(this.uniL[e],t[e]);break;case"1f":this.gl.uniform1f(this.uniL[e],t[e]);break;case"1iv":this.gl.uniform1iv(this.uniL[e],t[e]);break;case"1i":this.gl.uniform1i(this.uniL[e],t[e])}},gl3.util={hsva:function(t,e,r,i){if(!(e>1||r>1||i>1)){var a=t%360,n=Math.floor(a/60),s=a/60-n,l=r*(1-e),o=r*(1-e*s),h=r*(1-e*(1-s)),g=new Array;if(!e>0&&0>!e)g.push(r,r,r,i);else{var u=new Array(r,o,l,l,h,r),c=new Array(h,r,r,o,l,l),E=new Array(l,l,h,r,r,o);g.push(u[n],c[n],E[n],i)}return g}},easeLiner:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeOutCubic:function(t){return(t=t/1-1)*t*t+1},easeQuintic:function(t){var e=(t/=1)*t,r=e*t;return r*e}},gl3.v3=function(){},gl3.v3.prototype.create=function(){return new Float32Array(3)},gl3.v3.prototype.normalize=function(t){var e=this.create(),r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);if(r>0){var i=1/r;e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}return e},gl3.v3.prototype.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},gl3.v3.prototype.cross=function(t,e){var r=this.create();return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r},gl3.v3.prototype.faceNormal=function(t,e,r){var i=this.create(),a=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],n=[r[0]-t[0],r[1]-t[1],r[2]-t[2]];return i[0]=a[1]*n[2]-a[2]*n[1],i[1]=a[2]*n[0]-a[0]*n[2],i[2]=a[0]*n[1]-a[1]*n[0],this.normalize(i)},gl3.vec3=new gl3.v3,gl3.m4=function(){},gl3.m4.prototype.create=function(){return new Float32Array(16)},gl3.m4.prototype.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},gl3.m4.prototype.multiply=function(t,e,r){var i=t[0],a=t[1],n=t[2],s=t[3],l=t[4],o=t[5],h=t[6],g=t[7],u=t[8],c=t[9],E=t[10],f=t[11],p=t[12],T=t[13],R=t[14],_=t[15],d=e[0],m=e[1],v=e[2],A=e[3],b=e[4],U=e[5],M=e[6],y=e[7],P=e[8],x=e[9],D=e[10],F=e[11],B=e[12],L=e[13],I=e[14],X=e[15];return r[0]=d*i+m*l+v*u+A*p,r[1]=d*a+m*o+v*c+A*T,r[2]=d*n+m*h+v*E+A*R,r[3]=d*s+m*g+v*f+A*_,r[4]=b*i+U*l+M*u+y*p,r[5]=b*a+U*o+M*c+y*T,r[6]=b*n+U*h+M*E+y*R,r[7]=b*s+U*g+M*f+y*_,r[8]=P*i+x*l+D*u+F*p,r[9]=P*a+x*o+D*c+F*T,r[10]=P*n+x*h+D*E+F*R,r[11]=P*s+x*g+D*f+F*_,r[12]=B*i+L*l+I*u+X*p,r[13]=B*a+L*o+I*c+X*T,r[14]=B*n+L*h+I*E+X*R,r[15]=B*s+L*g+I*f+X*_,r},gl3.m4.prototype.scale=function(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1]*e[0],r[2]=t[2]*e[0],r[3]=t[3]*e[0],r[4]=t[4]*e[1],r[5]=t[5]*e[1],r[6]=t[6]*e[1],r[7]=t[7]*e[1],r[8]=t[8]*e[2],r[9]=t[9]*e[2],r[10]=t[10]*e[2],r[11]=t[11]*e[2],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},gl3.m4.prototype.translate=function(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],r[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],r[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],r[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],r},gl3.m4.prototype.rotate=function(t,e,r,i){var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(!a)return null;var n=r[0],s=r[1],l=r[2];1!=a&&(a=1/a,n*=a,s*=a,l*=a);var o=Math.sin(e),h=Math.cos(e),g=1-h,u=t[0],c=t[1],E=t[2],f=t[3],p=t[4],T=t[5],R=t[6],_=t[7],d=t[8],m=t[9],v=t[10],A=t[11],b=n*n*g+h,U=s*n*g+l*o,M=l*n*g-s*o,y=n*s*g-l*o,P=s*s*g+h,x=l*s*g+n*o,D=n*l*g+s*o,F=s*l*g-n*o,B=l*l*g+h;return e?t!=i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=u*b+p*U+d*M,i[1]=c*b+T*U+m*M,i[2]=E*b+R*U+v*M,i[3]=f*b+_*U+A*M,i[4]=u*y+p*P+d*x,i[5]=c*y+T*P+m*x,i[6]=E*y+R*P+v*x,i[7]=f*y+_*P+A*x,i[8]=u*D+p*F+d*B,i[9]=c*D+T*F+m*B,i[10]=E*D+R*F+v*B,i[11]=f*D+_*F+A*B,i},gl3.m4.prototype.lookAt=function(t,e,r,i){var a=t[0],n=t[1],s=t[2],l=r[0],o=r[1],h=r[2],g=e[0],u=e[1],c=e[2];if(a==g&&n==u&&s==c)return this.identity(i);var E,f,p,T,R,_,d,m,v,A;return d=a-e[0],m=n-e[1],v=s-e[2],A=1/Math.sqrt(d*d+m*m+v*v),d*=A,m*=A,v*=A,E=o*v-h*m,f=h*d-l*v,p=l*m-o*d,A=Math.sqrt(E*E+f*f+p*p),A?(A=1/A,E*=A,f*=A,p*=A):(E=0,f=0,p=0),T=m*p-v*f,R=v*E-d*p,_=d*f-m*E,A=Math.sqrt(T*T+R*R+_*_),A?(A=1/A,T*=A,R*=A,_*=A):(T=0,R=0,_=0),i[0]=E,i[1]=T,i[2]=d,i[3]=0,i[4]=f,i[5]=R,i[6]=m,i[7]=0,i[8]=p,i[9]=_,i[10]=v,i[11]=0,i[12]=-(E*a+f*n+p*s),i[13]=-(T*a+R*n+_*s),i[14]=-(d*a+m*n+v*s),i[15]=1,i},gl3.m4.prototype.perspective=function(t,e,r,i,a){var n=r*Math.tan(t*Math.PI/360),s=n*e,l=2*s,o=2*n,h=i-r;return a[0]=2*r/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-(i+r)/h,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(i*r*2)/h,a[15]=0,a},gl3.m4.prototype.ortho=function(t,e,r,i,a,n,s){var l=e-t,o=r-i,h=n-a;return s[0]=2/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/o,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/h,s[11]=0,s[12]=-(t+e)/l,s[13]=-(r+i)/o,s[14]=-(n+a)/h,s[15]=1,s},gl3.m4.prototype.transpose=function(t,e){return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},gl3.m4.prototype.inverse=function(t,e){var r=t[0],i=t[1],a=t[2],n=t[3],s=t[4],l=t[5],o=t[6],h=t[7],g=t[8],u=t[9],c=t[10],E=t[11],f=t[12],p=t[13],T=t[14],R=t[15],_=r*l-i*s,d=r*o-a*s,m=r*h-n*s,v=i*o-a*l,A=i*h-n*l,b=a*h-n*o,U=g*p-u*f,M=g*T-c*f,y=g*R-E*f,P=u*T-c*p,x=u*R-E*p,D=c*R-E*T,F=1/(_*D-d*x+m*P+v*y-A*M+b*U);return e[0]=(l*D-o*x+h*P)*F,e[1]=(-i*D+a*x-n*P)*F,e[2]=(p*b-T*A+R*v)*F,e[3]=(-u*b+c*A-E*v)*F,e[4]=(-s*D+o*y-h*M)*F,e[5]=(r*D-a*y+n*M)*F,e[6]=(-f*b+T*m-R*d)*F,e[7]=(g*b-c*m+E*d)*F,e[8]=(s*x-l*y+h*U)*F,e[9]=(-r*x+i*y-n*U)*F,e[10]=(f*A-p*m+R*_)*F,e[11]=(-g*A+u*m-E*_)*F,e[12]=(-s*P+l*M-o*U)*F,e[13]=(r*P-i*M+a*U)*F,e[14]=(-f*v+p*d-T*_)*F,e[15]=(g*v-u*d+c*_)*F,e},gl3.m4.prototype.vpFromCamera=function(t,e,r,i){this.lookAt(t.position,t.centerPoint,t.upDirection,e),this.perspective(t.fovy,t.aspect,t.near,t.far,r),this.multiply(r,e,i)},gl3.mat4=new gl3.m4,gl3.q4=function(){},gl3.q4.prototype.create=function(){return new Float32Array(4)},gl3.q4.prototype.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},gl3.q4.prototype.inverse=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},gl3.q4.prototype.normalize=function(t){var e=t[0],r=t[1],i=t[2],a=t[3],n=Math.sqrt(e*e+r*r+i*i+a*a);return 0===n?(t[0]=0,t[1]=0,t[2]=0,t[3]=0):(n=1/n,t[0]=e*n,t[1]=r*n,t[2]=i*n,t[3]=a*n),t},gl3.q4.prototype.multiply=function(t,e,r){var i=t[0],a=t[1],n=t[2],s=t[3],l=e[0],o=e[1],h=e[2],g=e[3];return r[0]=i*g+s*l+a*h-n*o,r[1]=a*g+s*o+n*l-i*h,r[2]=n*g+s*h+i*o-a*l,r[3]=s*g-i*l-a*o-n*h,r},gl3.q4.prototype.rotate=function(t,e,r){var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(!i)return null;var a=e[0],n=e[1],s=e[2];1!=i&&(i=1/i,a*=i,n*=i,s*=i);var l=Math.sin(.5*t);return r[0]=a*l,r[1]=n*l,r[2]=s*l,r[3]=Math.cos(.5*t),r},gl3.q4.prototype.toVecIII=function(t,e,r){var i=create(),a=create(),n=create();return inverse(e,n),i[0]=t[0],i[1]=t[1],i[2]=t[2],multiply(n,i,a),multiply(a,e,n),r[0]=n[0],r[1]=n[1],r[2]=n[2],r},gl3.q4.prototype.toMatIV=function(t,e){var r=t[0],i=t[1],a=t[2],n=t[3],s=r+r,l=i+i,o=a+a,h=r*s,g=r*l,u=r*o,c=i*l,E=i*o,f=a*o,p=n*s,T=n*l,R=n*o;return e[0]=1-(c+f),e[1]=g-R,e[2]=u+T,e[3]=0,e[4]=g+R,e[5]=1-(h+f),e[6]=E-p,e[7]=0,e[8]=u-T,e[9]=E+p,e[10]=1-(h+c),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},gl3.q4.prototype.slerp=function(t,e,r,i){var a=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],n=1-a*a;if(0>=n)i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3];else if(n=Math.sqrt(n),Math.abs(n)<1e-4)i[0]=.5*t[0]+.5*e[0],i[1]=.5*t[1]+.5*e[1],i[2]=.5*t[2]+.5*e[2],i[3]=.5*t[3]+.5*e[3];else{var s=Math.acos(a),l=s*r,o=Math.sin(s-l)/n,h=Math.sin(l)/n;i[0]=t[0]*o+e[0]*h,i[1]=t[1]*o+e[1]*h,i[2]=t[2]*o+e[2]*h,i[3]=t[3]*o+e[3]*h}return i},gl3.qtn=new gl3.q4,gl3.camera={create:function(t,e,r,i,a,n,s){var l=new gl3.cam,o=gl3.vec3.create();return o[0]=r[0],o[1]=r[1],o[2]=r[2],o=gl3.vec3.normalize(o),l.init(t,e,o,i,a,n,s),l}},gl3.cam=function(){},gl3.cam.prototype.position=gl3.vec3.create(),gl3.cam.prototype.centerPoint=gl3.vec3.create(),gl3.cam.prototype.upDirection=gl3.vec3.create(),gl3.cam.prototype.basePosition=gl3.vec3.create(),gl3.cam.prototype.baseCenterPoint=gl3.vec3.create(),gl3.cam.prototype.baseUpDirection=gl3.vec3.create(),gl3.cam.prototype.fovy=45,gl3.cam.prototype.aspect=1,gl3.cam.prototype.near=.1,gl3.cam.prototype.far=1,gl3.cam.prototype.init=function(t,e,r,i,a,n,s){this.position=gl3.vec3.create(),this.centerPoint=gl3.vec3.create(),this.upDirection=gl3.vec3.create(),this.basePosition=gl3.vec3.create(),this.baseCenterPoint=gl3.vec3.create(),this.baseUpDirection=gl3.vec3.create(),this.position[0]=this.basePosition[0]=t[0],this.position[1]=this.basePosition[1]=t[1],this.position[2]=this.basePosition[2]=t[2],this.centerPoint[0]=this.baseCenterPoint[0]=e[0],this.centerPoint[1]=this.baseCenterPoint[1]=e[1],this.centerPoint[2]=this.baseCenterPoint[2]=e[2],this.upDirection[0]=this.baseUpDirection[0]=r[0],this.upDirection[1]=this.baseUpDirection[1]=r[1],this.upDirection[2]=this.baseUpDirection[2]=r[2],this.fovy=i,this.aspect=a,this.near=n,this.far=s},gl3.cam.prototype.get_canvas_aspect=function(){return gl3.canvas?gl3.canvas.width/gl3.canvas.height:void 0},gl3.mesh={torus:function(t,e,r,i,a){var n,s,l,o=[],h=[],g=[],u=[],c=[];for(n=0;t>=n;n++){var E=2*Math.PI/t*n,f=Math.cos(E),p=Math.sin(E);for(s=0;e>=s;s++){var T=2*Math.PI/e*s,R=(f*r+i)*Math.cos(T),_=p*r,d=(f*r+i)*Math.sin(T),m=f*Math.cos(T),v=f*Math.sin(T);l=a?a:gl3.util.hsva(360/e*s,1,1,1);var A=1/e*s,b=1/t*n+.5;b>1&&(b-=1),b=1-b,o.push(R,_,d),h.push(m,p,v),g.push(l[0],l[1],l[2],l[3]),u.push(A,b)}}for(n=0;t>n;n++)for(s=0;e>s;s++)E=(e+1)*n+s,c.push(E,E+e+1,E+1),c.push(E+e+1,E+e+2,E+1);return{position:o,normal:h,color:g,texCoord:u,index:c}},sphere:function(t,e,r,i){var a,n,s,l=[],o=[],h=[],g=[],u=[];for(a=0;t>=a;a++){var c=Math.PI/t*a,E=Math.cos(c),f=Math.sin(c);for(n=0;e>=n;n++){var p=2*Math.PI/e*n,T=f*r*Math.cos(p),R=E*r,_=f*r*Math.sin(p),d=f*Math.cos(p),m=f*Math.sin(p);s=i?i:gl3.util.hsva(360/t*a,1,1,1),l.push(T,R,_),o.push(d,E,m),h.push(s[0],s[1],s[2],s[3]),g.push(1-1/e*n,1/t*a)}}for(c=0,a=0;t>a;a++)for(n=0;e>n;n++)c=(e+1)*a+n,u.push(c,c+1,c+e+2),u.push(c,c+e+2,c+e+1);return{position:l,normal:o,color:h,texCoord:g,index:u}},cube:function(t,e){for(var r,i=.5*t,a=[-i,-i,i,i,-i,i,i,i,i,-i,i,i,-i,-i,-i,-i,i,-i,i,i,-i,i,-i,-i,-i,i,-i,-i,i,i,i,i,i,i,i,-i,-i,-i,-i,i,-i,-i,i,-i,i,-i,-i,i,i,-i,-i,i,i,-i,i,i,i,i,-i,i,-i,-i,-i,-i,-i,i,-i,i,i,-i,i,-i],n=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],s=[],l=0;l<a.length/3;l++)r=e?e:gl3.util.hsva(360/a.length/3*l,1,1,1),s.push(r[0],r[1],r[2],r[3]);var o=[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];return{position:a,normal:n,color:s,texCoord:o,index:h}}},AudioCtr.prototype.load=function(t,e,r,i){var a=this.ctx,n=i?this.bgmGain:this.soundGain,s=this.src;s[e]=null;var l=new XMLHttpRequest;l.open("GET",t,!0),l.responseType="arraybuffer",l.onload=function(){a.decodeAudioData(l.response,function(t){s[e]=new AudioSrc(a,n,t,r),s[e].loaded=!0,console.log("audio loaded : index "+e+"; ")},function(t){console.log(t)})},l.send()},AudioCtr.prototype.loadComplete=function(){var t,e;for(e=!0,t=0;t<this.src.length;t++)e=e&&null!=this.src[t]&&this.src[t].loaded;return e},AudioSrc.prototype.play=function(){var t,e,r;if(t=this.bufferSource.length,r=-1,t>0){for(e=0;t>e;e++)if(!this.bufferSource[e].playnow){this.bufferSource[e]=null,this.bufferSource[e]=this.ctx.createBufferSource(),r=e;break}0>r&&(this.bufferSource[this.bufferSource.length]=this.ctx.createBufferSource(),r=this.bufferSource.length-1)}else this.bufferSource[0]=this.ctx.createBufferSource(),r=0;this.bufferSource[r].buffer=this.audioBuffer,this.bufferSource[r].loop=this.loop,this.bufferSource[r].playbackRate.value=1,this.loop||(this.bufferSource[r].onended=function(){this.stop(0),this.playnow=!1}),this.bufferSource[r].connect(this.gain),this.bufferSource[r].start(0),this.bufferSource[r].playnow=!0},AudioSrc.prototype.end=function(t){this.bufferSource[t].stop(0),this.playnow=!1};